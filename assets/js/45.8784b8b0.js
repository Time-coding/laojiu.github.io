(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{77:function(a,e,t){"use strict";t.r(e);var s=t(0),n=Object(s.a)({},function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"andoid开发规范"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#andoid开发规范","aria-hidden":"true"}},[a._v("#")]),a._v(" andoid开发规范")]),a._v(" "),t("h2",{attrs:{id:"开发规范"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开发规范","aria-hidden":"true"}},[a._v("#")]),a._v(" 开发规范")]),a._v(" "),t("ul",[t("li",[a._v("统一Android Studio版本")]),a._v(" "),t("li",[a._v("统一Gradle版本")]),a._v(" "),t("li",[a._v("统一转化为Androidx")]),a._v(" "),t("li",[a._v("引入的第三方包不要使用+")]),a._v(" "),t("li",[a._v("统一签名文件"),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("keytool -genkey -v -keystore my-release-key.keystore -alias my-key-alias -keyalg RSA -keysize "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2048")]),a._v(" -validity "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100000")]),a._v("\n")])])])]),a._v(" "),t("li",[a._v("git/svn忽略文件\n"),t("ul",[t("li",[a._v(".gradle和.idea文件，这是AS自己生成的文件")]),a._v(" "),t("li",[a._v("local_properties")]),a._v(" "),t("li",[a._v("*.iml")]),a._v(" "),t("li",[a._v("app/build")]),a._v(" "),t("li",[a._v("build")])])])]),a._v(" "),t("h2",{attrs:{id:"打包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#打包","aria-hidden":"true"}},[a._v("#")]),a._v(" 打包")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("生成签名文件")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("keytool -genkey -v -keystore my-release-key.keystore -alias my-key-alias -keyalg RSA -keysize "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2048")]),a._v(" -validity "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100000")]),a._v("\n")])])]),t("p",[t("code",[a._v("my-release-key.keystore")]),a._v("是生成的签名文件名。"),t("br"),a._v(" "),t("code",[a._v("my-key-alias")]),a._v("是别名。"),t("br"),a._v("\n100000是有效时间，2048是RSA加密的大小。")]),a._v(" "),t("p",[a._v("JKS 密钥库使用专用格式。建议使用")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("keytool -importkeystore -srckeystore demo-release-key.keystore -destkeystore demo-release-key.keystore -deststoretype pkcs12\n")])])]),t("p",[a._v("迁移到行业标准格式 PKCS12。")])]),a._v(" "),t("li",[t("p",[a._v("设置配置文件"),t("code",[a._v("android/app/build.gradle")])]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("signingConfigs "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  debug "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    storeFile "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("file")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'debug.keystore'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    storePassword "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'android'")]),a._v("\n    keyAlias "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'androiddebugkey'")]),a._v("\n    keyPassword "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'android'")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  release "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    storeFile "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("file")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'my-release-key.keystore'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//需要放在当前目录下，否则就用绝对路径")]),a._v("\n    storePassword "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'123456'")]),a._v("\n    keyAlias "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'my-key-alias'")]),a._v("\n    keyPassword "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'123456'")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\nbuildTypes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  debug "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    signingConfig signingConfigs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("debug\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  release "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Caution! In production, you need to generate your own keystore file.")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// see https://facebook.github.io/react-native/docs/signed-apk-android.")]),a._v("\n    signingConfig signingConfigs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("release "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//初始化这里是debug需要改一下")]),a._v("\n    minifyEnabled enableProguardInReleaseBuilds\n    proguardFiles "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getDefaultProguardFile")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"proguard-android.txt"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"proguard-rules.pro"')]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])]),a._v(" "),t("li",[t("p",[a._v("用指令打包")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" android "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" ./gradlew assembleRelease\n")])])]),t("p",[t("code",[a._v("gradlew")]),a._v("是android下的一个文件，"),t("code",[a._v("assembleRelease")]),a._v("是参数。")])])]),a._v(" "),t("p",[a._v("打包后的目录是"),t("code",[a._v("android/app/build/outputs/apk")]),a._v("。此目录下有两个文件夹"),t("code",[a._v("debug")]),a._v("和"),t("code",[a._v("release")]),a._v(",分别放着各自的apk。")]),a._v(" "),t("h2",{attrs:{id:"keytool指令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#keytool指令","aria-hidden":"true"}},[a._v("#")]),a._v(" keytool指令")]),a._v(" "),t("p",[t("code",[a._v("keytool -help")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("命令:\n\n-certreq            生成证书请求\n-changealias        更改条目的别名\n-delete             删除条目\n-exportcert         导出证书\n-genkeypair         生成密钥对\n-genseckey          生成密钥\n-gencert            根据证书请求生成证书\n-importcert         导入证书或证书链\n-importpass         导入口令\n-importkeystore     从其他密钥库导入一个或所有条目\n-keypasswd          更改条目的密钥口令\n-list               列出密钥库中的条目\n-printcert          打印证书内容\n-printcertreq       打印证书请求的内容\n-printcrl           打印 CRL 文件的内容\n-storepasswd        更改密钥库的存储口令\n")])])]),t("h2",{attrs:{id:"转换为androidx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#转换为androidx","aria-hidden":"true"}},[a._v("#")]),a._v(" 转换为Androidx")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("打开AS，Refactor=>Migrate to AndroidX,如果报错，先把引入的第三方包注释掉；")])]),a._v(" "),t("li",[t("p",[a._v("当出现如下类似错误"),t("br"),a._v(" "),t("font",{attrs:{color:"red"}},[a._v("Could not resolve androidx.core:core:1.0.1.")]),t("br"),a._v("\n你可以在"),t("code",[a._v("android/build.gradle")]),a._v("下这么操作"),t("a",{attrs:{href:"https://github.com/flutter/flutter/issues/27254",target:"_blank",rel:"noopener noreferrer"}},[a._v("github"),t("OutboundLink")],1)],1),a._v(" "),t("div",{staticClass:"language-gradle extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("subprojects {\n    project.configurations.all {\n      resolutionStrategy.eachDependency { details ->\n        if (details.requested.group == 'androidx.core' &&\n              !details.requested.name.contains('androidx')) {\n                    details.useVersion \"1.0.1\"\n                  }\n      }\n    }    \n}\n")])])])]),a._v(" "),t("li",[t("p",[a._v("转换之可能找不到一些类，如")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("错误: 程序包android.support.annotation不存在\n")])])]),t("p",[a._v("解决方式：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("import android.support.annotation.Nullable;\n//替换为\nimport androidx.annotation.Nullable;\n")])])])])]),a._v(" "),t("h2",{attrs:{id:"gradle版本5-x导致的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gradle版本5-x导致的","aria-hidden":"true"}},[a._v("#")]),a._v(" gradle版本5.x导致的")]),a._v(" "),t("p",[t("font",{attrs:{color:"red"}},[a._v("Cannot add task 'wrapper' as a task with that name already exists")])],1),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('task wrapper(type: Wrapper) {\n    gradleVersion = \'4.4\'    \n    distributionUrl = distributionUrl.replace("bin", "all")\n}\n')])])]),t("p",[a._v("改成")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('\nwrapper {\n    gradleVersion = \'4.4\'\n    distributionUrl = distributionUrl.replace("bin", "all")\n}\n')])])]),t("h2",{attrs:{id:"android签名修改"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#android签名修改","aria-hidden":"true"}},[a._v("#")]),a._v(" Android签名修改")]),a._v(" "),t("p",[a._v("Android签名修改会对微信支付有影响，会出现无法调起，解决方式就是退出微信重新登录，或者删除微信重新下载。")])])},[],!1,null,null,null);e.default=n.exports}}]);